{
  "$id": "https://barnevern.ssb.no/migration-report.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "migration-report-response-v1",
  "description": "Migration report for specific municipality",
  "type": "object",
  "required": [
    "municipalityId",
    "migrationYear",
    "isUsingMigrationId",
    "sak",
    "melding",
    "undersokelse",
    "relasjon",
    "plan",
    "tiltak"
  ],
  "definitions": {
    "elementCounts": {
      "$id": "https://barnevern.ssb.no/migration-report-element-counts.schema.json",
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "title": "migration-report-element-counts-v1",
      "description": "Schema for counts and error section",
      "type": "object",
      "required": [
        "numberOfKostraItems",
        "numberOfIdentifiedFagsystemItems"
      ],
      "properties": {
        "numberOfKostraItems": {
          "type": "integer",
          "description": "Number of Kostra-items inspected"
        },
        "numberOfIdentifiedFagsystemItems": {
          "type": "integer",
          "description": "Number of Kostra-items inspected"
        },
        "errors": {
          "type": "array",
          "description": "Array of errors",
          "items": {
            "type": "object",
            "required": [
              "kostraJournalId",
              "kostraId",
              "errorType"
            ],
            "properties": {
              "kostraJournalId": {
                "type": "string",
                "description": "Journal ID from Kostra"
              },
              "kostraId": {
                "type": "string",
                "description": "Element ID from Kostra"
              },
              "errorType": {
                "type": "string",
                "enum": [
                  "ElementNotFound",
                  "MultipleElementsFound",
                  "StartDateMismatch"
                ],
                "description": "Error type"
              },
              "fagsystemCaseId": {
                "type": "string",
                "description": "Case ID from fagsystem if present"
              },
              "fagsystemId": {
                "type": "string",
                "description": "Element ID from fagsystem if present"
              },
              "migrertId": {
                "type": "string",
                "description": "Migration ID for element when present"
              }
            }
          }
        }
      }
    }
  },
  "properties": {
    "municipalityId": {
      "type": "string",
      "description": "Four-digit municipality ID"
    },
    "districtId": {
      "type": "string",
      "description": "Two-digit district ID"
    },
    "migrationYear": {
      "type": "integer",
      "minimum": 2023,
      "description": "Year from municipality migration date"
    },
    "isUsingMigrationId": {
      "type": "boolean",
      "description": "true when one or more cases with migration-id detected"
    },
    "sak": {
      "$ref": "#/definitions/elementCounts"
    },
    "melding": {
      "$ref": "#/definitions/elementCounts"
    },
    "undersokelse": {
      "$ref": "#/definitions/elementCounts"
    },
    "relasjon": {
      "$ref": "#/definitions/elementCounts"
    },
    "plan": {
      "$ref": "#/definitions/elementCounts"
    },
    "tiltak": {
      "$ref": "#/definitions/elementCounts"
    }
  }
}
